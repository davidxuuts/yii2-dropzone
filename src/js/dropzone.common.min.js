Dropzone.autoDiscover=false;jQuery(function(e){const t='<div class="modal fade" id="dropzone-modal" aria-hidden="true" data-backdrop="static" style="display: none;" tabindex="-1">'+'    <div class="modal-dialog">'+'        <div class="modal-content">'+'            <div class="modal-header">'+'                <button type="button" class="close" data-dismiss="modal" aria-label="Close">'+'                    <span aria-hidden="true">×</span>'+"                </button>"+"            </div>"+'            <div class="modal-body">'+'                <div class="img-container">'+"                    <p>Loading ...</p>"+"                </div>"+"            </div>"+'            <div class="modal-footer">'+'                <button class="btn btn-secondary" data-dismiss="modal">关闭</button>'+'                <button type="submit" class="btn btn-primary">OK</button>'+"            </div>"+"        </div>"+"    </div>"+"</div>";e("section.content").append(t)});const dropzones=$(".dropzone-container");const getHash=function(i){return new Promise(function(e,t){let o="";let n=new FileReader;n.readAsArrayBuffer(i);n.onload=()=>{o=getEtag(n.result);e(o)}})};function init(o,n,e,i){let t="undefined";if(Object.prototype.toString.call(e)==="[object Array]"){t="array"}if(Object.prototype.toString.call(e)==="[object Object]"){t="object"}if(t==="array"&&e.length>0){let t=[];e.map(function(e){if(Object.prototype.toString.call(e)==="[object Object]"&&e.hasOwnProperty("name")&&e.hasOwnProperty("size")&&e.hasOwnProperty("path")){o.displayExistingFile(e,e.path);if(i){t.push(e.id)}else{t.push(e.path)}n.parent().find(".progress").attr({style:"opacity:0;"})}});n.val(t.toString())}if(t==="object"&&e.hasOwnProperty("name")&&e.hasOwnProperty("size")&&e.hasOwnProperty("path")){o.displayExistingFile(e,e.path);if(i){n.val(e.id)}else{n.val(e.path)}n.parent().find(".progress").attr({style:"opacity:0;"})}if(t==="array"&&e.length>=o.options.maxFiles||t==="object"&&o.options.maxFiles<=1){$(o.options.previewsContainer).find(".fileinput-button").parent().addClass("none")}}function dropzoneEvents(n,i,l,a,s,r,d,p){Array.prototype.indexOf=function(t){for(let e=0;e<this.length;e++){if(this[e]===t)return e}return-1};Array.prototype.remove=function(e){let t=this.indexOf(e);if(t>-1){this.splice(t,1)}};n.on("addedfile",function(e){});n.on("addedfiles",function(){if(n.files.length>=n.options.maxFiles){$(n.options.previewsContainer).find(".fileinput-button").parent().addClass("none")}});n.on("sending",function(e,t,o){$.each(l,function(e,t){o.append(e,t)});let n=e.name.substr(e.name.lastIndexOf("."));const i=e.type.split("/",1)[0];let a="others";if(i==="image"){a="images"}else if(i==="video"){a="videos"}else if(i==="audio"){a="audios"}o.append("key",s+a+"/"+r+n);if(d){o.append("x:file_type",a);o.append("token",p)}});n.on("error",(e,t)=>{n.removeFile(e);Swal.fire({toast:true,position:"top-end",title:n.options.dictResponseError,showConfirmButton:false,icon:"error"})});n.on("success",function(e,o){console.log(o);if(o.success===true||o.success==="true"){if(a){if(n.options.maxFiles>1){let e=i.val();console.log("158 fieldEl",i,"val",e);let t=e.split(",");if(t.includes("0")){t.remove("0")}t.push(o.result.id);i.val(t.toString());console.log("165 fieldEl",i,"val",e)}else{i.val(o.result.id);console.log("167, fieldEl",i,"val",i.val())}}else{if(n.options.maxFiles>1){let e=i.val();console.log("173, fieldEl",i,"val",e);let t=e.split(",");t.push(o.result.path);i.val(t.toString());console.log("177, fieldEl",i,"val",e)}else{i.val(o.result.path);console.log("fieldEl 180",i,"val",i.val())}}i.parent().find(".progress").attr({style:"opacity:0;"})}else{n.removeFile(e);Swal.fire({toast:true,position:"top-end",title:o.result,showConfirmButton:false,icon:"error"})}});n.on("maxfilesexceeded",function(e){n.removeFile(e);$(n.options.previewsContainer).find(".fileinput-button").parentNode.addClass("none")});n.on("removedfile",function(e){let t=i.val();let o=t.split(",");Array.prototype.removeValue=function(o){for(let e=0,t=0;e<this.length;e++){if(this[e]!=o){this[t++]=this[e]}}this.length-=1};if(a){o.removeValue(e.id)}else{o.removeValue(e.path)}i.val(o.toString());i.parent().find(".fileinput-button").parent().removeClass("none")})}function transformFile(l){return function(o,n){$("#dropzone-modal").modal("show");let e=$("#dropzone-modal").find('button[type="submit"]');let i=this;e.on("click",function(e){e.preventDefault();var t=a.getCroppedCanvas({width:256,height:256});t.toBlob(function(t){i.createThumbnail(t,i.options.thumbnailWidth,i.options.thumbnailHeight,i.options.thumbnailMethod,false,function(e){i.emit("thumbnail",o,e);n(t)})});$("#dropzone-modal").modal("hide")});const t=new Image;t.src=URL.createObjectURL(o);$("#dropzone-modal").find(".img-container").html(t);const a=new Cropper(t,l)}}